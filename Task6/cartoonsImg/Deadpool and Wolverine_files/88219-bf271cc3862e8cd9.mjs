(self.modernJsonp=self.modernJsonp||[]).push([["88219"],{454387:function(e,t,i){i.r(t),i.d(t,{default:()=>a});let n={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VideoWithContextLogging_pin",selections:[{args:null,kind:"FragmentSpread",name:"VideoWrapper_pin"}],type:"Pin",abstractKey:null};n.hash="93ed23334d5bac81ac8410f05c4f2031";let a=n},111923:function(e,t,i){i.d(t,{Z:()=>g});var n=i(581722),a=i(575108),r=i(105433),o=i(542092),d=i(611134),s=i(189976),l=i(800300),u=i(696323);let h={[o.o.aggregatedComment]:"AggregatedCommentReplyResource",[o.o.pin]:"AggregatedCommentResource",[o.o.didIt]:"DidItCommentsResource"};function g(){let e=(0,n.I0)(),{aggregatedCommentCreated:t,updateCommentCount:i}=(0,r.nf)();return async({commentMedia:n,force:r=!0,fromUnifiedComment:o,objectId:g,objectType:p,orbacSubjectId:m,pinId:c,replyToCommentId:E,tags:_,text:T})=>{let y=h[p],f={force:r,objectId:g,pinId:c,tags:_,text:T,replyToCommentId:E,...m?{orbacSubjectId:m}:{},...n?{commentMedia:n}:{}},v=u.Z.AGGREGATED_COMMENTS;o&&(v="pin"===p?u.Z.UNIFIED_COMMENTS:u.Z.AGGREGATED_COMMENT_REPLIES);let D=await a.Z.create(y,f).callCreate({showError:!1}),C=D.resource_response.data;return t(g,C),e((0,s.vX)({feedType:v,feedId:g,itemIds:[C.id],itemType:C.type,prepend:!0})),"aggregatedComment"===p?i(g,1):"didIt"===p&&e((0,d.L8)(g,1)),c&&e((0,l.R)(c,1)),C.id||D}}},707915:function(e,t,i){i.d(t,{Z:()=>d});var n=i(667294),a=i(20256),r=i(601686),o=i(785893);let d=(0,n.forwardRef)(({accessibilityLabel:e,handleClick:t,icon:i,iconColor:d,iconOnly:s,testId:l,buttonText:u,tabIndex:h,bgColor:g,isActive:p},m)=>{let[c,E]=(0,n.useState)(!1),_=(0,n.useRef)(null);(0,n.useImperativeHandle)(m,()=>_.current);let{setAbortNoActionPlacementTimeout:T}=(0,r.x4)(),y=()=>{E(e=>!e),t(),T(!0)},f=e=>{_&&e.target instanceof Element&&!_.current?.contains(e.target)&&E(!1)};return(0,n.useEffect)(()=>(window.addEventListener("mousedown",f),()=>{window.removeEventListener("mousedown",f)}),[]),(0,n.useEffect)(()=>{void 0!==p&&E(p)},[p]),(0,o.jsx)(a.xu,{"data-test-id":l||"closeup-action-bar-button",children:(0,o.jsxs)(a.kC,{alignItems:"center",justifyContent:"start",children:[(0,o.jsx)(a.hU,{ref:_,accessibilityLabel:e,bgColor:g,icon:i,iconColor:d||"darkGray",onClick:y,selected:c,size:s?"md":"lg",tabIndex:h}),u&&(0,o.jsx)(a.iP,{onTap:y,rounding:2,children:(0,o.jsx)(a.X6,{color:"light",overflow:"normal",size:"400",children:u})})]})})})},906498:function(e,t,i){i.d(t,{Z:()=>o});var n=i(675973),a=i(15667),r=i(647709);let o=({skipExpActivation:e=!1}={})=>{let{checkExperiment:t}=(0,n.Z)(),i=(0,r.HG)(),{isAuthenticated:o}=(0,a.B)();return o&&i?t("closeup_dweb_adaptive_images",{dangerouslySkipActivation:e}):{anyEnabled:!1,group:""}}},105433:function(e,t,i){i.d(t,{pb:()=>y,nf:()=>f,lV:()=>v});var n=i(667294),a=i(581722),r=i(441143),o=i.n(r),d=i(575108),s=i(729434),l=i(686319),u=i(791948),h=i(503246),g=i(991384);let p={feature_map:Object.freeze({})},m=(e,t)=>{let i={...(0,g.Z)(e,t),...t.reaction_counts?{reaction_counts:t.reaction_counts}:Object.freeze({}),...t.tags?{tags:t.tags}:Object.freeze({}),...t.tagged_users?{tagged_users:t.tagged_users}:Object.freeze({})};return(0,h.ZP)(e,i)?e:i},c=(e,t)=>{if(e=e||p,"FETCH_COMPLETE"===t.type){let{payload:{resource:i}}=t,{data:n}=t.payload.response.resource_response;if("AggregatedCommentFeedResource"===i||"AggregatedCommentReplyFeedResource"===i||"DidItCommentsResource"===i){let t=(n||[]).reduce((t,i)=>(t[i.id]=m(e[i.id],i),t),{});return{...e,...t}}if("UnifiedCommentsResource"===i&&n&&n.length>0){let t=n.filter(e=>"aggregatedcomment"===e.type).reduce((t,i)=>(t[i.id]=m(e[i.id],i),t),{});return{...e,...t}}if("UnifiedCommentsPreviewResource"===i&&n&&n.length>0){let t=n.map(e=>e.aggregated_comment).reduce((t,i)=>(i&&(t[i.id]=m(e[i.id],i)),t),{}),i=n.map(e=>e.creator_reply).reduce((t,i)=>(i&&i.id&&(t[i.id]=m(e[i.id],i)),t),{});return{...e,...t,...i}}if("AggregatedCommentFeaturesResource"===i&&n&&Object.keys(n).length>0)return{...e,feature_map:n}}else if("AGGREGATED_COMMENT_CREATED"===t.type){let{payload:{aggregatedComment:i}}=t;return i.id?{...e,[i.id]:i}:e}else if("AGGREGATED_COMMENT_DELETED"===t.type||"AGGREGATED_COMMENT_HIDDEN"===t.type){let{payload:{aggregatedCommentId:i}}=t,n={...e};return delete n[i],n}else if("AGGREGATED_COMMENT_HIDDEN_FOR_USER"===t.type){let{payload:{userId:i}}=t;return Object.fromEntries(Object.entries(e).filter(e=>e[1].user?.id!==i))}else if("AGGREGATED_COMMENT_UPDATED"===t.type){let{payload:{data:i}}=t;return{...e,[i.id]:m(e?.[i.id],i)}}else if("AGGREGATED_COMMENT_LIKE_TOGGLED"===t.type){let{payload:{data:i}}=t,n=e?.[i.id],a=n?.reaction_counts[1]||0,r={1:i.reaction_by_me?a+1:a-1},o={...n,reaction_by_me:i.reaction_by_me,reaction_counts:r};return{...e,[i.id]:o}}else if("AGGREGATED_COMMENT_HELPFUL_TOGGLED"===t.type){let{payload:{data:i}}=t,n=e?.[i.id],a=n?.helpful_count||0,r=i.marked_helpful_by_me?a+1:a-1,o={...n,marked_helpful_by_me:i.marked_helpful_by_me,helpful_count:r};return{...e,[i.id]:o}}else if("AGGREGATED_COMMENT_HIGHLIGHT_TOGGLED"===t.type){let{payload:{data:i}}=t,n={...e?.[i.aggregated_comment_id],highlighted_by_pin_owner:i.is_highlighted};return{...e,[i.aggregated_comment_id]:n}}else if("AGGREGATED_COMMENT_FEATURES_UPDATED"===t.type){let{payload:{data:{featureMap:i}}}=t;return{...e,feature_map:{...e?.feature_map,...i}}}else if("UPDATE_AGGREGATED_COMMENT_COMMENT_COUNT"===t.type){let{payload:{increment:i,id:n}}=t,a=e?.[n];if(!a)return e;let r={...a,comment_count:a.comment_count+i};return{...e,[n]:r}}else if("DELETE_COMMENT_MENTION"===t.type){let{payload:{aggregatedCommentId:i,tagged_users:n}}=t,a={...e?.[i],tagged_users:n};return{...e,[i]:a}}else if("GET_COMMENT_TRANSLATION"===t.type){let{payload:{aggregatedCommentId:i,translatedText:n}}=t,a={...e?.[i],translatedText:n};return{...e,[i]:a}}return e};var E=i(785893);let{Provider:_,get:T}=(0,s.Z)("AggregatedComments");function y({children:e}){let t=(0,a.v9)(({resources:e})=>e?.UnifiedCommentsResource),i=p;t&&Object.values(t).forEach(e=>{let t=e.data?.filter(e=>"aggregatedcomment"===e.type),n=t?.reduce((e,t)=>(e[t.id]=m(i[t.id],t),e),{});i={...i,...n}});let[r,o]=(0,n.useReducer)(c,i),d=e=>{o({type:"FETCH_COMPLETE",payload:e})};(0,u.Z8)("AggregatedCommentFeaturesResource",d),(0,u.my)("AggregatedCommentFeaturesResource",d),(0,u.Z8)("AggregatedCommentFeedResource",d),(0,u.my)("AggregatedCommentFeedResource",d),(0,u.Z8)("AggregatedCommentReplyFeedResource",d),(0,u.my)("AggregatedCommentReplyFeedResource",d),(0,u.Z8)("DidItCommentsResource",d),(0,u.my)("DidItCommentsResource",d),(0,u.Z8)("UnifiedCommentsPreviewResource",d),(0,u.my)("UnifiedCommentsPreviewResource",d),(0,u.Z8)("UnifiedCommentsResource",d),(0,u.my)("UnifiedCommentsResource",d);let s=(0,n.useMemo)(()=>({aggregatedComments:r,dispatch:o}),[r,o]);return(0,E.jsx)(_,{value:s,children:e})}function f(){let{dispatch:e}=T();return(0,n.useMemo)(()=>({aggregatedCommentCreated(t,i){e({type:"AGGREGATED_COMMENT_CREATED",payload:{parentId:t,aggregatedComment:i}})},aggregatedCommentDeleted:(t,i)=>{e({type:"AGGREGATED_COMMENT_DELETED",payload:{parentId:t,aggregatedCommentId:i}})},aggregatedCommentHidden:t=>{e({type:"AGGREGATED_COMMENT_HIDDEN",payload:{aggregatedCommentId:t}})},aggregatedCommentsHiddenForUser:t=>{e({type:"AGGREGATED_COMMENT_HIDDEN_FOR_USER",payload:{userId:t}})},flagAggregatedComment:async({isAggregatedComment:e=!0,commentId:t,reason:i,detailedReasons:n})=>{let a=e?`/v3/aggregated_comments/${t}/flag/`:`/v3/did_it/${t}/flag/`;return(0,l.Z)({url:a,method:"PUT",data:{commentId:t,reason:i,detailedReasons:n}})},deleteCommentMention:async t=>{let{resource_response:i}=await (0,l.Z)({url:`/v3/aggregated_comments/${t}/mentions/`,method:"DELETE",data:{fields:["aggregatedcomment.id","aggregatedcomment.tagged_users"]}}),n=i.data??{};e({type:"DELETE_COMMENT_MENTION",payload:{aggregatedCommentId:n.id,tagged_users:n.tagged_users}})},translateAggregatedComment:async t=>{try{let{resource_response:i}=await (0,l.Z)({url:`/v3/aggregated_comments/${t}/translate/`,method:"GET"}),n=i.data??"";e({type:"GET_COMMENT_TRANSLATION",payload:{aggregatedCommentId:t,translatedText:n}})}catch(i){e({type:"GET_COMMENT_TRANSLATION",payload:{aggregatedCommentId:t,translatedText:""}})}},toggleAggregatedCommentHelpful:({aggregatedCommentId:t,isMarkedHelpfulByMe:i,orbacSubjectId:n})=>{(0,l.Z)({url:`/v3/helpful/1/${t}/`,method:i?"DELETE":"POST",data:n?{orbac_subject_id:n}:{}}),e({type:"AGGREGATED_COMMENT_HELPFUL_TOGGLED",payload:{data:{id:t,marked_helpful_by_me:!i}}})},toggleAggregatedCommentHighlight:async({aggregatedCommentId:t,pinId:i,isHighlighted:n})=>{o()(t,"Could not find comment"),o()(i,"Could not find Pin"),await (0,l.Z)({url:"/v3/aggregated_comments/pin/highlight/",method:"PUT",data:{aggregated_comment:t,pin:i,highlight:!n}}),e({type:"AGGREGATED_COMMENT_HIGHLIGHT_TOGGLED",payload:{data:{aggregated_comment_id:t,pin_id:i,is_highlighted:!n}}})},toggleAggregatedCommentLike:({aggregatedCommentId:t,isLikedByMe:i,orbacSubjectId:n})=>{(0,l.Z)({url:`/v3/aggregated_comments/${t}/react/`,method:i?"DELETE":"POST",data:{reaction_type:1,...n?{orbac_subject_id:n}:{}}}),e({type:"AGGREGATED_COMMENT_LIKE_TOGGLED",payload:{data:{id:t,reaction_by_me:+!i}}})},updateAggregatedComment:async({commentId:t,force:i,orbacSubjectId:n,tags:a,text:r})=>{let{resource_response:o}=await d.Z.create("AggregatedCommentResource",{commentId:t,force:i,tags:a,text:r,...n?{orbacSubjectId:n}:{}}).callUpdate({showError:!1}),{tagged_users:s}=o.data??{};e({type:"AGGREGATED_COMMENT_UPDATED",payload:{data:{id:t,tagged_users:s.map(e=>({...e})),tags:JSON.parse(a),text:r}}})},updateAggregatedCommentFeatures:async({userId:t,featureMap:i,passcode:n,userConfirmPasscode:a})=>{let r={userId:t,featureMap:i,passcode:n,user_confirm_skip_passcode:a};void 0===a&&(r.user_confirm_skip_passcode=!1);let{resource_response:o}=await d.Z.create("AggregatedCommentFeaturesResource",r).callUpdate({showError:!1});e({type:"AGGREGATED_COMMENT_FEATURES_UPDATED",payload:{data:{featureMap:o.data??Object.freeze({})}}})},updateCommentCount:(t,i)=>{e({type:"UPDATE_AGGREGATED_COMMENT_COMMENT_COUNT",payload:{increment:i,id:t}})}}),[e])}function v(){let{aggregatedComments:e}=T();return e}},542092:function(e,t,i){i.d(t,{n:()=>a,o:()=>n});let n={aggregatedComment:"aggregatedComment",didIt:"didIt",pin:"pin"},a={aggregatedComment:"aggregatedcomment",didIt:"userdiditdata",pin:"pin"}},611134:function(e,t,i){i.d(t,{Wx:()=>l,uL:()=>d,lg:()=>c,aX:()=>s,YH:()=>h,IU:()=>E,DD:()=>m,Th:()=>_,wH:()=>u,L8:()=>p});var n=i(575108),a=i(686319),r=i(189976),o=i(696323);function d(e,t){return{type:"USER_DID_IT_DATA_LIKE_TOGGLED",payload:{id:e,liked_by_me:t}}}function s({didItDataId:e,orbacSubjectId:t}){return(0,a.Z)({url:`/v3/did_it/${e}/like/`,method:"POST",data:t?{orbac_subject_id:t}:{}})}function l({didItDataId:e,orbacSubjectId:t}){return(0,a.Z)({url:`/v3/did_it/${e}/like/`,method:"DELETE",data:t?{orbac_subject_id:t}:{}})}function u({didItDataId:e,isLikedByMe:t,orbacSubjectId:i}){return n=>((0,a.Z)({url:`/v3/did_it/${e}/like/`,method:t?"DELETE":"POST",data:i?{orbac_subject_id:i}:{}}),n(d(e,!t)))}function h({didItDataId:e,isMarkedHelpfulByMe:t,orbacSubjectId:i}){return n=>((0,a.Z)({url:`/v3/helpful/2/${e}/`,method:t?"DELETE":"POST",data:i?{orbac_subject_id:i}:{}}),n({type:"USER_DID_IT_DATA_HELPFUL_TOGGLED",payload:{id:e,marked_helpful_by_me:!t}}))}function g(e){return{type:"USER_DID_IT_DATA_DELETE",payload:{id:e}}}function p(e,t){return{type:"USER_DID_IT_DATA_UPDATE_COMMENT_COUNT",payload:{id:e,increment:t}}}function m({aggregatedPinDataId:e,details:t,fromUnifiedComment:i,image_signatures:a,pin_id:d,username:s,updateParentDidItCount:l}){let u={aggregatedPinDataId:e,details:t,image_signatures:a,pin_id:d};return t=>n.Z.create("DidItActivityResource",u).callCreate().then(n=>{let a=n.resource_response.data;t({type:"PIN_DID_IT",payload:{id:d,value:!0}}),t({type:"USER_DID_IT_DATA_CREATE",payload:{user_did_it_data:a}}),t((0,r.vX)({feedId:e,feedType:i?o.Z.UNIFIED_COMMENTS:o.Z.TRIED_IT_FEED,itemIds:[a.id],itemType:a.type,prepend:!0})),t((0,r.vX)({feedId:s,feedType:o.Z.TRIED_IT_FEED,itemIds:[a.id],itemType:a.type})),l&&t(p(e,1))},()=>{})}function c({aggregatedPinDataId:e,feedType:t,id:i,isOwnedByMe:a,pinId:d,username:s,updateParentDidItCount:l}){return u=>{n.Z.create("DidItActivityResource",{user_did_it_data_id:i,pinId:d}).callDelete().then(()=>{a&&u({type:"PIN_DID_IT",payload:{id:d,value:!1}}),u(g(i)),u((0,r.EX)({feedId:e??"",feedType:t||o.Z.TRIED_IT_FEED,itemIds:[i],itemType:"userdiditdata"})),u((0,r.EX)({feedId:s,feedType:o.Z.TRIED_IT_FEED,itemIds:[i],itemType:"userdiditdata"})),u((0,r.EX)({feedId:s,feedType:o.Z.UNIFIED_COMMENTS,itemIds:e?[e]:[],itemType:"userdiditdata"})),l&&u(p(i,-1))},()=>{})}}function E({id:e,details:t,image_signatures:i,pinId:a}){let r={details:t,image_signatures:i,user_did_it_data_id:e,pin_id:a};return e=>{n.Z.create("DidItActivityResource",r).callUpdate().then(t=>{e({type:"USER_DID_IT_DATA_UPDATE",payload:{user_did_it_data:t.resource_response.data}})},()=>{})}}function _(e,t,i,n,d){return s=>{(0,a.Z)({url:`/v3/did_it/${i}/flag/`,method:"PUT",data:{reason:n,detailed_reasons:t,explanation:void 0}}).then(()=>{s(g(i)),e&&s((0,r.EX)({feedId:e,feedType:o.Z.TRIED_IT_FEED,itemIds:[i],itemType:"userdiditdata"})),s((0,r.EX)({feedId:d,feedType:o.Z.TRIED_IT_FEED,itemIds:[i],itemType:"userdiditdata"}))},()=>{})}}},800300:function(e,t,i){i.d(t,{R:()=>n});function n(e,t){return{type:"PIN_UPDATE_COMMENT_COUNT",payload:{id:e,increment:t}}}},720445:function(e,t,i){i.d(t,{ZP:()=>G});var n,a=i(281098),r=i(667294);i(422578);var o=i(20256),d=i(980787),s=i(289032),l=i(28427),u=i(115247),h=i(675973),g=i(15667),p=i(149026),m=i(792171),c=i(589357),E=i(603316),_=i(78762),T=i(785893);function y(e,t,i){var n;return(t="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?n:n+"")in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let f=(0,_.Z)(()=>Promise.all([i.e("25418"),i.e("22244"),i.e("31142")]).then(i.bind(i,509691)),void 0,e=>509691,"app-www-video-VideoWrapper",e=>["25418","22244","31142"]),v=[0,.25,.5,.75,.95,.97],D=[0,.5,.8,.99,1],C={rootMargin:"-64px 0px 0px 0px",threshold:[...c.iM]},I=Object.freeze({LOADING:0,PLAYING:1,PAUSED:2,STALLING:3}),A=(void 0!==n||(n=i(454387)).hash&&"93ed23334d5bac81ac8410f05c4f2031"!==n.hash&&console.error("The definition of 'VideoWithContextLogging_pin' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data."),n);function w(){return new Date().getTime()}function b(e){return!!e.volume&&e.volume>0}class R extends r.Component{constructor(e){super(e),y(this,"videoWrapperRef",(0,r.createRef)()),y(this,"handleWindowResize",()=>{if(!this.fullscreen){let e=this.getDimensions(),{height:t,width:i}=this.currentInterval;e.height!==t||e.width!==i?(this.lastLoggedTime.startTime=0,this.startNewInterval(e)):(this.currentInterval.windowHeight=e.windowHeight,this.currentInterval.windowWidth=e.windowWidth)}}),y(this,"handlePlayheadDown",({event:e})=>{let{onPlayheadDown:t}=this.props;this.setState({seeking:!0}),t&&t({event:e})}),y(this,"handlePlayheadUp",({event:e})=>{let{onPlayheadUp:t}=this.props;this.setState({seeking:!1}),t&&t({event:e})}),y(this,"handleLoop",()=>{this.videoTime=0}),y(this,"handlePlaying",e=>{this.logVideoStart(),this.props.onPlaying&&this.props.onPlaying(e)}),y(this,"handleTimeChange",e=>{let{seeking:t,ready:i}=this.state;if(!this.currentInterval.videoDuration)return;let n=1e3*e.time,a=function(e,t,i,n){if(e>t||i<=0)return null;for(let a of n){let n=a*i;if(e<=n&&t>n)return a}return null}(this.videoTime,n,this.currentInterval.videoDuration,v);if("number"==typeof a&&this.props.playing&&!t&&i){let e=w();this.props.isMetricThrottleExpEnabled?this.isVideoEventLogIntervalMet("currentTime")&&this.logVideoEvent(6906,{...this.currentInterval,startTime:e,endTime:e,videoStartTime:0,videoEndTime:0,quartile:Math.floor(4*a),quartilePercentValue:a}):this.logVideoEvent(6906,{...this.currentInterval,startTime:e,endTime:e,videoStartTime:0,videoEndTime:0,quartile:Math.floor(4*a),quartilePercentValue:a})}this.videoTime=n,this.props.onTimeChange&&this.props.onTimeChange(e)}),y(this,"handleDurationChange",e=>{this.currentInterval.videoDuration=1e3*e.duration,this.props.onDurationChange&&this.props.onDurationChange(e)}),y(this,"handleReady",e=>{let{ready:t}=this.state;t||(this.lastLoggedTime.startTime=0,this.setState({ready:!0})),this.props.onReady&&this.props.onReady(e)}),y(this,"handleEnded",e=>{this.props.isMetricThrottleExpEnabled?this.isVideoEventLogIntervalMet("endTime")&&this.logFourthQuartileEvent():this.logFourthQuartileEvent(),this.props.loop&&(this.startNewInterval(),this.currentInterval.videoStartTime=0),this.props.onEnded&&this.props.onEnded(e)}),y(this,"handleVisibilityChange",e=>{if(0===e.length)return;let t=function(e){for(let t=0;t<D.length;t+=1){let i=D[t],n=D[t+1];if(null==n||i<=e&&e<n)return i}return null}(Number.parseFloat(e.slice(-1)[0].intersectionRatio.toFixed(2)));"number"==typeof t&&(this.visible=t>=.5),null==t||t===this.currentInterval.viewability||this.fullscreen||(0===t?this.startNewInterval({viewability:t,playbackState:I.PAUSED}):this.startNewInterval({viewability:t}))}),y(this,"handleFullscreenChange",({event:e,fullscreen:t})=>{if(t){let{height:e,width:t}=window.screen;this.startNewInterval({height:e,width:t,windowHeight:e,windowWidth:t})}else t||this.startNewInterval(this.getDimensions());this.fullscreen=t,this.props.onFullscreenChange&&this.props.onFullscreenChange({event:e,fullscreen:t})}),y(this,"handleClose",()=>{this.startNewInterval()}),this.state={ready:!1,seeking:!1,started:!1};let t=w();this.handleWindowResize=(0,s.Z)(this.handleWindowResize,1e3),this.currentInterval={videoDuration:0,startTime:t,endTime:t,videoStartTime:0,videoEndTime:0,isAudible:b(e),playbackState:this.getPlaybackState(e,this.state),quartile:-1,quartilePercentValue:0,height:null,width:null,windowHeight:null,windowWidth:null,viewability:null},this.videoTime=0,this.fullscreen=!1,this.visible=null,this.lastLoggedTime={startTime:0,endTime:0,currentTime:0}}componentDidMount(){(0,a.Z)("VideoWithContextLogging","/app/www/video/VideoWithContextLogging.tsx"),this.currentInterval={...this.currentInterval,...this.getDimensions()},window.addEventListener("resize",this.handleWindowResize),window.addEventListener("beforeunload",this.handleClose)}componentDidUpdate(e,t){let i={};b(e)&&!b(this.props)?i.isAudible=!1:!b(e)&&b(this.props)&&(i.isAudible=!0);let n=this.getPlaybackState(this.props,this.state);this.getPlaybackState(e,t)!==n&&(i.playbackState=n),Object.keys(i).length>0&&this.startNewInterval(i)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),window.removeEventListener("beforeunload",this.handleClose),this.startNewInterval()}getPlaybackState(e,t){return t.ready?e.playing&&!t.seeking?I.PLAYING:I.PAUSED:I.LOADING}getDimensions(){let e,t;if(this.videoWrapperRef.current){let i=this.videoWrapperRef.current;i.clientHeight&&i.clientWidth&&(e=i.clientHeight,t=i.clientWidth)}return{height:e,width:t,windowHeight:window.innerHeight,windowWidth:window.innerWidth}}logMetricStat(e){let{requestContext:t}=this.props,i=t?.userAgent||{},n={appType:i.isMobile||i.isTablet?"WEB_MOBILE":"WEB_DENZEL",country:t?.country??"unknown",browserName:i.browserName,osName:i.osName,browserType:i.browserType,browserVersion:i.browserVersion,type:e};(0,E.nP)("webapp.metrics.videoLogging.skippedEvents",{tags:n})}isVideoEventLogIntervalMet(e){let t=w();return 250>Math.abs(t-this.lastLoggedTime[e])?(this.logMetricStat(e),!1):(this.lastLoggedTime[e]=t,!0)}logVideoEvent(e,t){let{closeupStoryPinViewability:i,contextLogData:n,logContextEvent:a,playing:r,surface:o}=this.props,{seeking:d}=this.state,{height:s,width:l,windowHeight:u,windowWidth:h,viewability:g,...p}=t;if(null!=s&&null!=l&&null!=u&&null!=h&&null!=g){let t={...p,gridAutoplay:6904===e&&r&&!d&&("AuthHomefeed"===o||"SearchItem"===o||"RelatedPinGrid"===o||"PdpRelatedPinGrid"===o),height:s,width:l,windowHeight:u,windowWidth:h,viewability:i||g};a({event_type:e,...function(e){let{eventData:{videoEvent:{gridAutoplay:t,videoDuration:i,startTime:n,endTime:a,videoStartTime:r,videoEndTime:o,isAudible:d,height:s,width:l,playbackState:u,quartile:h,quartilePercentValue:g,windowHeight:p,windowWidth:m,viewability:c}},component:E,objectId:_,view:T,viewParameter:y,...f}=e;return{component:E,object_id_str:_,view_type:T,view_parameter:y,aux_data:{...f},event_data:{videoEventData:{gridAutoplay:t,videoDuration:i?Math.floor(i):0,time:n,endTime:a,videoTime:r?Math.floor(r):0,endVideoTime:o?Math.floor(o):0,isAudible:d,height:s,width:l,playbackState:u,quartile:h,quartilePercentValue:g,windowHeight:p,windowWidth:m,viewability:c}}}}({...n,view:this.fullscreen?108:n.view,eventData:{videoEvent:t}})})}}logFourthQuartileEvent(){let e=w();this.logVideoEvent(6906,{...this.currentInterval,startTime:e,endTime:e,videoStartTime:0,videoEndTime:0,quartile:4,quartilePercentValue:1})}logVideoStart(){if(this.state.started)return;let{contextLogData:e,setVideoPlayed:t,shouldLogVideoStart:i}=this.props;if(i){let e=w();this.logVideoEvent(3621,{...this.currentInterval,startTime:e,endTime:e,videoEndTime:this.videoTime})}t(e.objectId),this.setState({started:!0})}startNewInterval(e){let t=w();this.props.isMetricThrottleExpEnabled?this.isVideoEventLogIntervalMet("startTime")&&this.logVideoEvent(6904,{...this.currentInterval,endTime:t,videoEndTime:this.videoTime}):this.logVideoEvent(6904,{...this.currentInterval,endTime:t,videoEndTime:this.videoTime}),this.currentInterval={...this.currentInterval,...e,startTime:t,videoStartTime:this.videoTime,endTime:-1,videoEndTime:-1}}render(){let{rootMargin:e,surface:t,aspectRatio:i,backgroundColor:n,captions:a,contextLogData:r,controls:d,fallback:s,hlsConfig:l,isAutoPlay:h,loop:g,objectFit:m,onLoadedChange:c,onControlsPause:E,onControlsPlay:_,onSeek:y,onVolumeChange:v,pin:D,playbackRate:I,playing:A,playsInline:w,poster:b,preload:R,seekTime:G,src:M,videoStartTime:N,volume:L,video:O,variant:P,setVideoRef:S}=this.props,{seeking:U}=this.state;return void 0!==e&&(C.rootMargin=t?(0,p.eL)(t):e),(0,T.jsx)(u.Z,{onVisibilityChange:this.handleVisibilityChange,options:C,children:e=>(0,T.jsx)(o.xu,{ref:t=>{e.current=t,this.videoWrapperRef.current=t},height:"inherit",children:(0,T.jsx)(f,{aspectRatio:i,backgroundColor:n,captions:a,contextLogData:r,controls:d,fallback:s,hlsConfig:l,isAutoPlay:h,loop:g,objectFit:m,onControlsPause:E,onControlsPlay:_,onDurationChange:this.handleDurationChange,onEnded:this.handleEnded,onFullscreenChange:this.handleFullscreenChange,onLoadedChange:c,onLoop:this.handleLoop,onPlay:()=>{},onPlayError:()=>{},onPlayheadDown:this.handlePlayheadDown,onPlayheadUp:this.handlePlayheadUp,onPlaying:this.handlePlaying,onReady:this.handleReady,onSeek:y,onTimeChange:this.handleTimeChange,onVolumeChange:v,pinKey:D,playbackRate:I,playing:!U&&A,playsInline:w,poster:b,preload:R,seekTime:G,setVideoRef:S,src:M,variant:P,video:O,videoStartTime:N,visible:this.visible,volume:L})})})}}function G(e){(0,r.useEffect)(()=>{(0,a.Z)("VideoWithContextLogging","/app/www/video/VideoWithContextLogging.tsx")},[]);let{pinKey:t}=e,i=(0,l.Z)(A,t),{logContextEvent:n}=(0,d.u)(),{checkExperiment:o}=(0,h.Z)(),{setVideoPlayed:s}=(0,m.H)(),u=o("web_video_start_log").anyEnabled,p=o("web_metric_video_throttle").anyEnabled,c=(0,g.B)();return(0,T.jsx)(R,{...e,isMetricThrottleExpEnabled:p,logContextEvent:n,pin:i,requestContext:c,setVideoPlayed:s,shouldLogVideoStart:u})}y(R,"defaultProps",o.nk.defaultProps)}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/88219-bf271cc3862e8cd9.mjs.map